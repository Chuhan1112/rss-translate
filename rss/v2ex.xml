<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>V2EX</title><link>https://www.v2ex.com/</link><description>way to explore</description><lastBuildDate>Sun, 21 Apr 2024 21:13:01 GMT</lastBuildDate><generator>rfeed v1.1.1</generator><docs>https://github.com/svpino/rfeed/blob/master/README.md</docs><item><title>[OpenAI] AI 影片读唇？</title><link>https://www.v2ex.com/t/1034457#reply0</link><description>&lt;p&gt;请问有没有 AI 可以线上辨识被消音的人声视频（视频读唇）的服务？
我是有看到几个 github 项目，但是有没有已经可以实际运行的？&lt;/p&gt;
&lt;p&gt;（原由是我拍了一些访问视频，麦克风出问题，全部被消音，只看到人说话嘴在动）&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 18:18:42 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034457#reply0</guid></item><item><title>[酷工作] 有没有对 Google search console 熟悉的人</title><link>https://www.v2ex.com/t/1034452#reply0</link><description>有没有对 Google search console 熟悉的人&lt;br /&gt;可以兼职帮我网站做一些优化提升 google search 的排名.&lt;br /&gt;&lt;br /&gt;有的话可以联系我, 最好是上海</description><pubDate>Sun, 21 Apr 2024 16:40:56 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034452#reply0</guid></item><item><title>[问与答] 哪位大神知道如何去背景？</title><link>https://www.v2ex.com/t/1034451#reply3</link><description>&lt;p&gt;rembg 处理得不是很好。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://remove.bg" rel="nofollow"&gt;remove.bg&lt;/a&gt; 费用又比较高。&lt;/p&gt;
&lt;p&gt;哪位大神能介绍一些方案或者便宜服务。
谢谢先&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 16:23:42 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034451#reply3</guid></item><item><title>[职场话题] 在接到口头 offer 后，应该从哪些因素去判断？</title><link>https://www.v2ex.com/t/1034450#reply1</link><description>&lt;p&gt;如题，一番鏖战后也是拿到个感觉还不错的 offer ，只不过是口头通知，允许给点时间思考下。看了下网上风评也相当可以，但终究要到切身体会的那一刻才知真假，所以还是在犹豫。
本人现有的流程不是刚开始，就是久久没有下文，之前拒掉的 offer 相较这个差距极大，所以也不知道怎么对比了。所以想问下各位过来人，应该从什么角度去考虑，才能得出比较踏实的结果？还是说先接了再说？&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 16:19:45 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034450#reply1</guid></item><item><title>[程序员] 远程在家办公，提高效率和生活质量的装备？</title><link>https://www.v2ex.com/t/1034448#reply0</link><description>目前已知的或者已有的：&lt;br /&gt;&lt;br /&gt;1. 升降桌子，坐太久真的不好，今天去宜家体验了一下，即使不是站着工作，也可以调节一个很好的坐姿位置&lt;br /&gt;2. 多屏这种就不用说了，配置一个屏幕鼠标切换器 mux ，台式和笔记本可以方便切换屏幕，主要切换 linux 和 windows 屏幕&lt;br /&gt;3. 强制屏保息屏软件+路由器自动关机，控制自己的作息，早睡，不乱刷手机&lt;br /&gt;4. 水栽绿萝，桌子上和墙壁挂了很多的水培绿萝，增加室内的湿度，和氧气浓度&lt;br /&gt;5. 瑜伽垫+跳绳一条， 简易健身套装&lt;br /&gt;6. 泡茶器皿，提神用的&lt;br /&gt;&lt;br /&gt;不知道其他 v 友 有什么好的其他的推荐？</description><pubDate>Sun, 21 Apr 2024 16:07:32 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034448#reply0</guid></item><item><title>[Web3] 程序员在 crypto/web3 中有哪些优势/机会？</title><link>https://www.v2ex.com/t/1034445#reply1</link><description>&lt;p&gt;总感觉程序员在 crypto/web3 的圈子里面会有一些优势&lt;/p&gt;
&lt;p&gt;比如说自动交易，套利，监控链上信号之类的&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 15:22:19 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034445#reply1</guid></item><item><title>[音乐] 有什么比较舒缓好听的歌曲吗？</title><link>https://www.v2ex.com/t/1034444#reply0</link><description>&lt;p&gt;最近偶然发现一首歌曲张真的《携手游人间》，感觉很适合现在的心境，比较舒缓。想到应该有不少这种比较舒缓，不适合歌手在舞台上翻唱，但淡淡的很有感觉的歌。有的话麻烦推荐几首，先谢谢了。&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 15:22:15 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034444#reply0</guid></item><item><title>[问与答] 求推荐验证码短信平台</title><link>https://www.v2ex.com/t/1034443#reply2</link><description>&lt;p&gt;如题，发送类似于 [签名] 你的验证码是 123456 ，这样的验证码登录注册短信，要求签名免审免实名，就只发验证码短信，我知道国内有很多大厂都可以发，但是无法免审免实名。请求大家给推荐推荐，费用比国内的平台高是可以接受的。&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 15:21:10 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034443#reply2</guid></item><item><title>[问与答] 最近想买个小主机，装个 esxi，跑一些家庭服务，想问一下大家畅网 P5 如何</title><link>https://www.v2ex.com/t/1034442#reply8</link><description>装 esxi&lt;br /&gt;跑 Ubuntu 、软路由、文件服务器、远程 win10&lt;br /&gt;想问问大家畅网 P5 如何，N100 的处理器应该是够用的 ，而且外观迷你耐看，但网上的评测很少，想问问有没有哪位老哥用过给点建议</description><pubDate>Sun, 21 Apr 2024 15:14:08 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034442#reply8</guid></item><item><title>[宽带症候群] 有没有类似 headscale 但无需专用服务器的东西？</title><link>https://www.v2ex.com/t/1034441#reply6</link><description>现有的各种方案，比如 zerotier moon, headscale 都需要自建一个中心化的服务来实现客户端的信息交换和转发。但其实客户端可以不通过中心服务器的.&lt;br /&gt;&lt;br /&gt;信息交换可以利用 irc/xmpp/mqtt 机器人， 这样利用公共资源就能做到信息交换&lt;br /&gt;&lt;br /&gt;包转发也可以先利用公共的 stun 来打洞，实在打不通才走 turn&lt;br /&gt;&lt;br /&gt;所以中心化的服务不可缺少的就是一个 turn 服务而已，其他都功能都可以被公共资源 offload ，如果客户端不是对称 nat 的话根本就不需要中心服务器的存在。&lt;br /&gt;&lt;br /&gt;现在有这种方案吗？</description><pubDate>Sun, 21 Apr 2024 15:10:11 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034441#reply6</guid></item><item><title>[macOS] mac os 如何安装一个新的虚拟网卡</title><link>https://www.v2ex.com/t/1034439#reply1</link><description>&lt;p&gt;我希望创建一个新的虚拟网卡，网卡通过 wifi 连接到路由器
然后原始网卡网关是 A ，虚拟网卡的网关是 B
（ A 是一个正常路由器的网关，B 是一个 openwrt 的软路由的网关）
A 和 B 是一个网段的，A 和 B 都可以各自正常通讯
各位大佬有什么方法吗？&lt;/p&gt;
&lt;p&gt;我试了试 tunnebrick ，似乎没有什么好的教程。&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 15:02:57 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034439#reply1</guid></item><item><title>[iPhone] iPhone 版 word 收费么？我看有一堆内购</title><link>https://www.v2ex.com/t/1034437#reply1</link><description>我只用 iPhone 阅读 word 文件</description><pubDate>Sun, 21 Apr 2024 14:56:53 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034437#reply1</guid></item><item><title>[C++] 学习 QT，尝试链接静态库，但怎么都链接不上，请教一下大佬们这是怎么回事</title><link>https://www.v2ex.com/t/1034435#reply4</link><description>&lt;p&gt;QT creator 12.0.2
Based on QT 6.6.0
windows 10&lt;/p&gt;
&lt;p&gt;windows git bash 输出的各个文件名
test 是自己的测试用的静态库
target 是可执行文件项目
libtest.a 已经生成了&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[pj]$ ls target/*
target/main.cpp  target/target.pro  target/target.pro.user  target/widget.cpp  target/widget.h  target/widget.ui
[pj]$ ls test/*
test/test.cpp  test/test.h  test/test.pro  test/test.pro.user  test/test_global.h
[pj]$ ls build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/*
build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/Makefile        build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/Makefile.Release
build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/Makefile.Debug

build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/debug:
libtest.a  test.o

build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/release:
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以下是 &lt;a href="http://test.pro" rel="nofollow"&gt;test.pro&lt;/a&gt;, 我加了&lt;code&gt;CONFIG += staticlib&lt;/code&gt;，现在在&lt;code&gt;build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/debug&lt;/code&gt;下只会生成 libtest.a ，不会生成 test.dll&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;QT -= gui

TEMPLATE = lib
DEFINES += TEST_LIBRARY

CONFIG += c++17

# You can make your code fail to compile if it uses deprecated APIs.
# In order to do so, uncomment the following line.
#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000    # disables all the APIs deprecated before Qt 6.0.0

SOURCES += \
    test.cpp

HEADERS += \
    test_global.h \
    test.h

CONFIG += staticlib
# Default rules for deployment.
unix {
    target.path = /usr/lib
}

!isEmpty(target.path): INSTALLS += target

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;我在默认的 &lt;a href="http://target.pro" rel="nofollow"&gt;target.pro&lt;/a&gt; 中添加了如下内容用来链接 libtest.a&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;win32: LIBS += -L$$PWD/../build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/debug/ -ltest

INCLUDEPATH += $$PWD/../test
DEPENDPATH += $$PWD/../test

win32:!win32-g++: PRE_TARGETDEPS += $$PWD/../build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/debug/libtest.a
else:win32-g++: PRE_TARGETDEPS += $$PWD/../build-test-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/debug/libtest.a
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;main.cpp&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include "widget.h"
#include "test.h"
#include &amp;lt;QApplication&amp;gt;

int main(int argc, char *argv[])
{
    Test t;
    t.print();  // print 是 test 的 public 函数，用 qDebug 输出函数名

    QApplication a(argc, argv);
    Widget w;
    w.show();
    return a.exec();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;编译报错 undefined reference, 应该是链接不到 libtest.a：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:-1: error: debug/main.o: in function `qMain(int, char**)':
D:\Qt\pj\target\main.cpp:7: error: undefined reference to `__imp__ZN4TestC1Ev'
:-1: error: D:\Qt\pj\build-target-Desktop_Qt_6_6_3_MinGW_64_bit-Debug/../target/main.cpp:8: undefined reference to `__imp__ZN4Test5printEv'
:-1: error: collect2.exe: error: ld returned 1 exit status
:-1: error: [Makefile.Debug:72: debug/target.exe] Error 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;不知道我是不是少了什么设置&lt;/p&gt;
&lt;p&gt;如果以上描述不到位，这是两个项目的文件。先构建 test ，后运行 target
&lt;a href="https://drive.google.com/file/d/1FxtwscpdG9Atj2-YnAnR-CCKcmIwx0P7/view?usp=drive_link" rel="nofollow"&gt;https://drive.google.com/file/d/1FxtwscpdG9Atj2-YnAnR-CCKcmIwx0P7/view?usp=drive_link&lt;/a&gt;&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 14:46:34 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034435#reply4</guid></item><item><title>[HomePod] HomePod Mini 突然变砖</title><link>https://www.v2ex.com/t/1034432#reply1</link><description>放在卧室沙发旁边，用的不多。今天过去刷手机发现 no response 无响应，手摸了一下发烫。&lt;br /&gt;&lt;br /&gt;拔了电源线再插上去，屏幕不亮，全无反应了，连电脑也没反应。&lt;br /&gt;&lt;br /&gt;网上看了一下，大概率是主板挂了，修一下 200+来回运费....&lt;br /&gt;&lt;br /&gt;我直接把尸体卖给维修商家了，用的太少了。&lt;br /&gt;&lt;br /&gt;RIP 21 年 1 月-24 年 4 月</description><pubDate>Sun, 21 Apr 2024 14:26:58 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034432#reply1</guid></item><item><title>[OpenAI] 稳定 GPT4 Claude3，企业 API 链路中转，直连 Azure , AWS，支持函数调用和高并发</title><link>https://www.v2ex.com/t/1034431#reply0</link><description>&lt;a href="http://api.kksj.org" rel="nofollow noopener" target="_blank"&gt;api.kksj.org&lt;/a&gt;&lt;br /&gt;企业 api 链路中转，百分之百稳定性&lt;br /&gt;支持 GPT 全模型，直连 azure&lt;br /&gt;支持 claude3 全模型，直连 AWS &lt;br /&gt;最新支持 gpt-4-turbo-2024-04-09 模型，直连 openai&lt;br /&gt;支持 suno-v3,dalle3,tts 等模型&lt;br /&gt;充值最低九毛一刀</description><pubDate>Sun, 21 Apr 2024 14:23:00 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034431#reply0</guid></item><item><title>[职场话题] 软件质量管理</title><link>https://www.v2ex.com/t/1034430#reply0</link><description>&lt;p&gt;测试转型质量管理有前途吗？上次因为英语问题错失了 23k 的 offer ，感觉我做功能测试是拿不到这么多的&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 14:16:47 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034430#reply0</guid></item><item><title>[程序员] IOT 系统 MQTT 协议有必要将设备 id 放在 topic 里吗</title><link>https://www.v2ex.com/t/1034426#reply7</link><description>&lt;p&gt;放：1W 台设备的话可能就有 1~3 万个 topic 在 broker 运行，一般 4H16G 的 linux 服务器撑不撑得住？&lt;/p&gt;
&lt;p&gt;不放：只设两个 topic ，down 和 up, 设备 id 放在载荷里，但是每次单点发布时，其实会给所有设备都发送一遍，pps 撑不撑得住，通讯模块是否会接受到很多无用信息，影响处理性能？&lt;/p&gt;
&lt;p&gt;还有一个群发的应用场景，请问如何实现最好。（无网关，目前采用的是遍历发送）&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 14:01:54 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034426#reply7</guid></item><item><title>[Apple] 现在是不是不能通过 itunes 下载旧版本 app 了？</title><link>https://www.v2ex.com/t/1034420#reply3</link><description>&lt;p&gt;之前一直用 12.3.6 版本的 itunes 通过抓包的方式下载旧版本的 app ，这几天发现 itunes 貌似已经不能下载 app 的安装文件到电脑上了，尝试下载任何 app 都是 0x80090302 错误，持续好多天了一直是这样。请问还有没有什么别的管道能下载到旧版本的 app 吗?&lt;/p&gt;</description><pubDate>Sun, 21 Apr 2024 13:16:17 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034420#reply3</guid></item><item><title>[SSL] 关于昨天淘宝证书过期</title><link>https://www.v2ex.com/t/1034418#reply5</link><description>&lt;p&gt;先放上昨天淘宝证书过期的讨论： &lt;a href="https://www.v2ex.com/t/1034182" rel="nofollow"&gt;https://www.v2ex.com/t/1034182&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;今天本想搜搜有关证书过期造成的事故，结果找到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.v2ex.com/t/327787" rel="nofollow"&gt;https://www.v2ex.com/t/327787&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.v2ex.com/t/411520" rel="nofollow"&gt;https://www.v2ex.com/t/411520&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.v2ex.com/t/411522" rel="nofollow"&gt;https://www.v2ex.com/t/411522&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.v2ex.com/t/510384" rel="nofollow"&gt;https://www.v2ex.com/t/510384&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以它这次的过期，到底是提前更换部署了但因为各种各样的缓存问题导致部分用户被过期证书威胁，还是的确就是过期了才马上补救？我发现被影响后十分钟左右就恢复了，很难相信是巧合，所以这个"恢复"更可能是阿里的操作还是我的运营商的操作？&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Certificate chain
 0 s:C = CN, ST = ZheJiang, L = HangZhou, O = "Alibaba (China) Technology Co., Ltd.", CN = taobao.com
   i:C = BE, O = GlobalSign nv-sa, CN = GlobalSign Organization Validation CA - SHA256 - G3
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Apr  8 03:36:05 2024 GMT; NotAfter: May 10 03:36:04 2025 GMT
&lt;/code&gt;&lt;/pre&gt;</description><pubDate>Sun, 21 Apr 2024 12:54:52 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034418#reply5</guid></item><item><title>[SSL] win-acme 自动续期 SSL 证书及上传 WAF</title><link>https://www.v2ex.com/t/1034417#reply0</link><description>&lt;h2&gt;前情提要&lt;/h2&gt;
&lt;p&gt;之前在 V2EX 咨询过阿里云免费 SSL 证书的替代方案（ &lt;a href="https://v2ex.com/t/999627" rel="nofollow"&gt;https://v2ex.com/t/999627&lt;/a&gt; ），考虑到阿里云服务器目前的操作系统是 Windows Server 2012 ，所以基于 Linux 或者 Docker 的方案就都 pass 了。&lt;/p&gt;
&lt;p&gt;再考虑到自动化更新 SSL 证书的需求，所以在经过一番调研之后，最终确定使用 win-acme （ &lt;a href="https://www.win-acme.com/" rel="nofollow"&gt;https://www.win-acme.com/&lt;/a&gt; ）来完成这一工作。因为虽然 Caddy 也能完成这项工作，但是还需要把在 IIS 中配置好的网站再重新配置一遍，还不知道会有什么新问题。本着尽量不要增加复杂度的理念，所以就没有采用 Caddy 。&lt;/p&gt;
&lt;p&gt;由于网站前面还有一层阿里云 WAF （ Web 应用防火墙），各网站的流量都是先由 WAF 检查一遍，过滤掉非法请求之后，才能最终到达服务器。而要使用 WAF 的话，各域名的 DNS 都是解析到 WAF 的地址上的，这也给后面的工作和问题排查带来了一些问题，不过这是后话了。&lt;/p&gt;
&lt;h2&gt;基本流程测试&lt;/h2&gt;
&lt;p&gt;把 win-acme 下载并解压到服务器上之后，运行程序，按照网上的教程一步步操作。为了不影响现有各域名上的业务，在阿里云服务器的 IIS 上配置了一个新的域名，并且在阿里云 WAF 里面接入了这个二级域名。&lt;/p&gt;
&lt;p&gt;按照教程的操作步骤，成功用 win-acme 申请到了这个二级域名的 SSL 证书，但是默认步骤只会生成一个 Windows IIS 所需的 pfx 格式的证书。如果要让阿里云 WAF 能够正常过滤 HTTPS 流量，还需要上传证书和对应的私钥到阿里云的数字证书管理服务中，然后在阿里云 WAF 的网站接入设置中选择所上传的证书才行。这样一来，还需要让 win-acme 生成 PEM 格式的证书和私钥。&lt;/p&gt;
&lt;p&gt;所以基础流程就是：申请证书 → 保存 PFX 格式证书 → 保存 PEM 格式证书。&lt;/p&gt;
&lt;h2&gt;配置阿里云 WAF&lt;/h2&gt;
&lt;p&gt;在用 win-acme 给各个域名申请证书的时候，在验证域名所有权的那一步，有的域名能够验证成功，有的域名就总会失败。考虑到 IIS 上各个域名的配置是一样的，又看了一下 DNS 解析也是一样的格式，那应该就是阿里云 WAF 的问题了。&lt;/p&gt;
&lt;p&gt;对比之后发现，有的域名在阿里云 WAF 的配置中同时勾选了 HTTP 和 HTTPS 协议，但是有的只勾选了 HTTPS 协议。对于只勾选了 HTTPS 协议的域名，有的还没有开启 HTTP 到 HTTPS 的强制跳转。&lt;/p&gt;
&lt;p&gt;加上域名的 DNS 解析是指向阿里云 WAF 的，于是猜测是 WAF 这里的设置导致了域名所有权的验证失败。于是给全部域名的 WAF 配置都同时勾选了 HTTP 和 HTTPS 协议，并且禁止了 HTTP 到 HTTPS 的强制跳转，这个时候，各个域名的所有权验证终于都能通过了。&lt;/p&gt;
&lt;h2&gt;Debug 阿里云 Cli&lt;/h2&gt;
&lt;p&gt;有了 win-acme ，SSL 证书的自动续期就搞定了。但是证书每次续期之后，还需要再把新的证书上传到阿里云的数字证书管理服务中，然后在阿里云 WAF 的网站接入设置中更新证书。既然是 Windows 系统，那就用 PowerShell 写个脚本来实现这个操作好了。&lt;/p&gt;
&lt;p&gt;而上面的需求需要调用阿里云的 API ，如果想要用脚本来实现这一功能，就还要用到阿里云 Cli 。在配置阿里云 Cli 的用户凭证时，AccessKey 凭证和 EcsRamRole 凭证方式一开始都有问题，最后把之前的配置信息都删了，新建了一个具有 &lt;code&gt;管理云盾应用防火墙（ WAF ）的权限&lt;/code&gt; 的用户，然后用该用户的 AccessKey 才终于成功调用了阿里云的 API 。&lt;/p&gt;
&lt;h2&gt;Debug PowerShell&lt;/h2&gt;
&lt;p&gt;在测试阿里云 API 的调用时，还遇到了一个有些隐蔽的问题，就是在阿里云的 OpenAPI 平台上测试接口调用的时候是没问题的，但是在 PowerShell 脚本中调用就是有问题。到了最后把两种方式的完整命令复制出来对比，才发现 PowerShell 的 &lt;code&gt;Get-Content&lt;/code&gt; 命令读取到的 SSL 证书和私钥的文本，换行符都没了，这尼玛！&lt;/p&gt;
&lt;p&gt;解决了这个问题后，续期后的新证书和私钥自动上传至阿里云并在 WAF 中更新的功能也就实现了，以后这项工作就不需要自己再手动操作了。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;最后再说一下完整的流程和注意事项吧。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用 win-acme 申请 SSL 证书并实现自动续期。这个程序能够自动把从 IIS 中读取网站信息，申请新证书关联到对应的网站，很省心。&lt;/li&gt;
&lt;li&gt;如果用到了阿里云 WAF 之类的服务，要想防护 HTTPS 流量，就需要上传 SSL 证书和私钥，这样的话需要配置 win-acme 再额外保存一份 PEM 格式的证书和私钥。其中 &lt;code&gt;-crt.pem&lt;/code&gt; 后缀的文件是需要导入 WAF 的证书文件，&lt;code&gt;-key.pem&lt;/code&gt; 后缀的文件则是需要导入 WAF 的私钥文件。&lt;/li&gt;
&lt;li&gt;如果用到了阿里云 WAF 之类的服务，并且各业务域名的 DNS 都解析到了 WAF 上，那么就要在 WAF 配置中同时启用 HTTP 和 HTTPS ，并且禁止 HTTP 到 HTTPS 的强制跳转，不然有可能在域名所有权验证那一步失败。&lt;/li&gt;
&lt;li&gt;配置阿里云 Cli 的时候，如果配置的各种凭证方式都不管用，可以尝试把旧的配置都删除，包括 Cli 里的配置和阿里云网页端控制台的配置，然后重新来一遍。&lt;/li&gt;
&lt;li&gt;PowerShell &lt;code&gt;Get-Content&lt;/code&gt; 命令拿到的证书和私钥的文本会丢失换行符，可以参考 &lt;a href="https://stackoverflow.com/a/15041925/2667665" rel="nofollow"&gt;https://stackoverflow.com/a/15041925/2667665&lt;/a&gt; 这里的方法来解决。&lt;/li&gt;
&lt;li&gt;上传证书和私钥调用的是 WAF 中的 &lt;code&gt;CreateCertificate&lt;/code&gt; 这个 API ，将证书关联至 WAF 中接入域名是 &lt;code&gt;CreateCertificateByCertificateId&lt;/code&gt; API 。&lt;/li&gt;
&lt;/ol&gt;</description><pubDate>Sun, 21 Apr 2024 12:53:04 GMT</pubDate><guid isPermaLink="true">https://www.v2ex.com/t/1034417#reply0</guid></item></channel></rss>